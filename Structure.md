## 專案概述
這是一個針對音頻錄製與上傳的系統，包含了前端裝置（edge client）與後端伺服器的交互。整個專案包含了音頻錄製設備的管理、錄音操作、數據上傳、伺服器端數據存儲和管理，並透過Socket.IO進行實時通信。

## 專案結構
專案的主要模組及檔案如下：
- `main.py`：應用程序的入口點，負責初始化Flask應用、數據庫、Socket.IO伺服器，並啟動應用程序。
- `config.py`：配置文件，包含應用所需的基本配置，如密鑰、資料庫URI、上傳目錄、時區設定等。
- `socket_events.py`：定義了各種Socket.IO事件的處理邏輯，負責管理裝置連接、狀態更新、錄音操作等。
- `utils.py`：工具函數集合，包含了文件哈希計算等常用功能。
- `routes.py`：定義了Flask的HTTP路由，處理網頁請求、文件上傳、錄音管理等功能。
- `models.py`：定義了數據庫模型，包含音頻錄音的數據結構。
- `shared_state.py`：全域性狀態管理，用於儲存連接的設備信息、排程等。
- `edge_client.py`：裝置端的客戶端應用程序，負責錄製音頻、與伺服器通信、上傳錄音文件。

### `main.py`
- **主要功能**：初始化並啟動應用，包括Flask應用、Socket.IO伺服器和數據庫。
- **資訊流**：應用啟動後，將數據庫表格初始化，並監聽伺服器端口來處理各種請求。
- **路由初始化**：匯入並初始化`routes.py`和`socket_events.py`中的路由和Socket.IO事件處理函數。

### `config.py`
- **主要功能**：提供應用程序的配置類別`Config`，配置項目如密鑰、資料庫URI、上傳目錄及時區等【11†source】。
- **資訊流**：應用程序通過`app.config.from_object(Config)`將配置加載至Flask應用中。

### `socket_events.py`
- **主要功能**：處理Socket.IO的各種事件，包括客戶端連接、設備註冊、錄音控制等【16†source】。
- **資訊流**：伺服器端根據客戶端的Socket.IO事件執行相應的操作，如錄音控制、狀態更新等。
- **事件處理**：包括`connect`（客戶端連接）、`register_device`（設備註冊）、`start_recording`（開始錄音）等。

### `utils.py`
- **主要功能**：提供通用工具函數，包含文件的SHA-256哈希計算【12†source】。
- **資訊流**：在錄音文件上傳過程中，使用哈希計算來驗證文件的完整性。

### `routes.py`
- **主要功能**：定義HTTP路由，處理錄音文件上傳、下載、播放及排程管理等功能【17†source】。
- **資訊流**：用戶通過HTTP請求與伺服器進行交互，伺服器根據請求執行相應操作，如上傳文件、檢查狀態等。
- **主要路由**：
  - `/upload_recording`：處理錄音文件的上傳。
  - `/recordings`：返回所有錄音的列表。
  - `/download/<int:id>`：提供錄音文件的下載。

### `models.py`
- **主要功能**：定義數據庫中的`AudioRecording`模型【14†source】。
- **資訊流**：錄音文件的元數據（如名稱、時長、上傳時間等）存儲在資料庫中，以便於管理和檢索。

### `shared_state.py`
- **主要功能**：管理應用的全域性狀態，如已連接的客戶端、錄音設備、排程信息等【13†source】。
- **資訊流**：各設備的連接狀態和排程管理均通過此模組的全域性字典來管理，確保應用內部狀態的一致性。

### `edge_client.py`
- **主要功能**：裝置端應用，用於錄製音頻、連接伺服器、上傳音頻文件【18†source】。
- **資訊流**：裝置啟動後，連接伺服器，並等待伺服器下達錄音命令；錄音完成後將音頻文件上傳至伺服器。
- **主要類別**：
  - `AudioRecorder`：管理音頻錄製與上傳操作。
  - `connect_to_server`：實現連接伺服器並重試機制。